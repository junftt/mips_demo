/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{var e={518:e=>{var t,r,s=(t=function(e,r){var s=r._cursor;setTimeout((function(){e.parentElement&&r._shouldBlinkCursor?(s.style.visibility="visible"===s.style.visibility?"hidden":"visible",t(e,r)):s.style.visibility="visible"}),500)},r=!0,promptInput=function(e,s,n,a){var i=1===n,c=document.createElement("input");c.style.position="absolute",c.style.zIndex="-100",c.style.outline="none",c.style.border="none",c.style.opacity="0",c.style.fontSize="0.2em",e._inputLine.textContent="",e._input.style.display="",e.html.appendChild(c),t(c,e),s.length&&e.print(3===n?s+" (y/n)":s),c.onblur=function(){e._cursor.style.display="none"},c.onfocus=function(){c.value=e._inputLine.textContent,e._cursor.style.display="inline"},e.html.onclick=function(){c.focus()},c.onkeydown=function(t){37===t.which||39===t.which||38===t.which||40===t.which||9===t.which?t.preventDefault():i&&13!==t.which&&setTimeout((function(){e._inputLine.textContent=c.value,e.html.scrollTop=e.html.scrollHeight}),1)},c.onkeyup=function(t){if(3===n||13===t.which){e._input.style.display="none";var r=c.value;i&&e.print(r+(13===t.which?"\n":"")),e.html.removeChild(c),"function"==typeof a&&a(3===n?"Y"===r.toUpperCase()[0]:r)}},r?(r=!1,setTimeout((function(){c.focus()}),50)):c.focus()},function(e){this.html=document.createElement("div"),this.html.className="Terminal","string"==typeof e&&(this.html.id=e),this._innerWindow=document.createElement("div"),this._output=document.createElement("span"),this._inputLine=document.createElement("span"),this._cursor=document.createElement("span"),this._input=document.createElement("span"),this._shouldBlinkCursor=!0,this.print=function(e){this._output.appendChild(document.createTextNode(e)),this.html.scrollTop=this.html.scrollHeight},this.input=function(e,t){promptInput(this,e,1,t)},this.password=function(e,t){promptInput(this,e,2,t)},this.confirm=function(e,t){promptInput(this,e,3,t)},this.clear=function(){this._output.textContent=""},this.sleep=function(e,t){setTimeout(t,e)},this.setTextSize=function(e){this._output.style.fontSize=e,this._input.style.fontSize=e},this.setTextColor=function(e){this.html.style.color=e,this._cursor.style.background=e},this.setBackgroundColor=function(e){this.html.style.background=e},this.setWidth=function(e){this.html.style.width=e},this.setHeight=function(e){this.html.style.height=e},this.blinkingCursor=function(e){e=e.toString().toUpperCase(),this._shouldBlinkCursor="TRUE"===e||"1"===e||"YES"===e},this._input.appendChild(this._inputLine),this._input.appendChild(this._cursor),this._innerWindow.appendChild(this._output),this._innerWindow.appendChild(this._input),this.html.appendChild(this._innerWindow),this.setBackgroundColor("black"),this.setTextColor("white"),this.setTextSize("1em"),this.setWidth("100%"),this.setHeight("100%"),this.html.style.fontFamily="Monaco, Courier",this.html.style.margin="0",this.html.style.overflow="auto",this._innerWindow.style.padding="10px",this._innerWindow.style.margin="0",this._innerWindow.style.whiteSpace="pre-wrap",this._innerWindow.style.wordBreak="break-all",this._input.style.margin="0",this._cursor.style.background="white",this._cursor.innerHTML="C",this._cursor.style.display="none",this._input.style.display="none"});e.exports={Terminal:s}},28:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addEventListener=t.setFillStyle=t.clearRect=t.fillRect=t.create=void 0;var r=null,s=null;t.create=function(e,t){s=document.createElement("canvas"),document.getElementById("canvas_area").appendChild(s),s.id="playground",s.width=e,s.height=t,r=s.getContext("2d")},t.fillRect=function(e,t,s,n){null==r||r.fillRect(e,t,s,n)},t.clearRect=function(e,t,s,n){null==r||r.clearRect(e,t,s,n)},t.setFillStyle=function(e,t,s){r.fillStyle="rgb("+e+","+t+","+s+")"},t.addEventListener=function(e,t,r){switch(e){case"keydown":document.body.addEventListener("keydown",(function(e){r(e.keyCode)}));break;case"timeout":var s=t[0];setTimeout((function(){r()}),s);break;case"raf":requestAnimationFrame((function(e){r(Math.floor(e))}));break;default:throw"unknow event: "+e}}},597:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(532),n=r(146);function a(e){return"f"+e}var i=[s.A0,s.A1,s.A2,s.A3,s.V0,s.V1,s.C1_FLAG].map((function(e){return s.registerName(e)}));function c(e,t){switch(t){case"beqz":case"beq":return e.i32.eq.bind(e.i32);case"bnez":case"bne":return e.i32.ne.bind(e.i32);case"bgez":case"bge":return e.i32.ge_s.bind(e.i32);case"blez":case"ble":return e.i32.le_s.bind(e.i32);case"bgtz":case"bgt":return e.i32.gt_s.bind(e.i32);case"bltz":case"blt":return e.i32.lt_s.bind(e.i32);case"c.eq.s":return e.f32.eq.bind(e.f32);case"c.ne.s":return e.f32.ne.bind(e.f32);case"c.gt.s":return e.f32.gt.bind(e.f32);case"c.lt.s":return e.f32.lt.bind(e.f32);case"c.ge.s":return e.f32.ge.bind(e.f32);case"c.le.s":return e.f32.le.bind(e.f32);case"add":case"addi":return e.i32.add.bind(e.i32);case"sub":return e.i32.sub.bind(e.i32);case"add.s":return e.f32.add.bind(e.f32);case"sub.s":return e.f32.sub.bind(e.f32);case"mul.s":return e.f32.mul.bind(e.f32);case"div.s":return e.f32.div.bind(e.f32);default:throw"unsupported branch op: "+t}}var o=function(){function e(e,t,r){this.instructions_=e,this.lableMap_=t,this.mainFunctionAddr_=r,this.functionInfo_=new Map}return e.prototype._fixMemoryImport=function(e){var t=e.emitText().replace(/\(memory [^\(]+\)/,'(import "env" "memory" (memory $0 10 10))'),r=binaryen.parseText(t);if(!r.validate())throw new Error("validation error");var s=r.emitBinary();return r.dispose(),s},e.prototype.compile=function(){var e=binaryen.i32,t=binaryen.f32,r=binaryen.Module,c=binaryen.none,o=binaryen.createType,u=(binaryen.Features,new r);u.setMemory(10,10),u.addFunctionImport("syscall","env","syscall",o([e,e,e,e,e]),c),u.addFunctionImport("sin","math","sin",o([t]),t),u.addFunctionImport("cos","math","cos",o([t]),t);for(var l=0,d=i;l<d.length;l++){var f=d[l];u.addGlobal(f,e,!0,u.i32.const(0))}u.addGlobal(s.registerName(s.SP),e,!0,u.i32.const(n.MEM_SIZE)),this._compileFunction(u,9999,this.mainFunctionAddr_),u.addFunctionExport(a(9999),"main");var m=null;if(this.functionInfo_.size>1){var h=this.functionInfo_.size-1;if(u.setFunctionTable(h,h,Array(h).fill(0).map((function(e,t){return a(t)}))),(m=new Map(this.functionInfo_)).delete(this.mainFunctionAddr_),m.size!=this.functionInfo_.size-1)throw"expecting main function being removed";u.addFunction("callback",o([e,e,e]),c,[],u.block("",[u.global.set(s.registerName(s.V0),u.local.get(1,e)),u.global.set(s.registerName(s.V1),u.local.get(2,e)),u.call_indirect("0",u.local.get(0,e),[],c,c)])),u.addFunctionExport("callback","callback")}if(u.addFunction("setV0V1",o([e,e]),c,[],u.block("",[u.global.set(s.registerName(s.V0),u.local.get(0,e)),u.global.set(s.registerName(s.V1),u.local.get(1,e))])),u.addFunctionExport("setV0V1","setV0V1"),u.addFunction("exit",c,c,[],u.unreachable()),u.addFunctionExport("exit","exit"),u.autoDrop(),!u.validate())throw new Error("validation error, check console");u.optimize();var g=this._fixMemoryImport(u);return u.dispose(),{wasm:g,functions:m}},e.prototype._isFunctionStart=function(e){return this.functionInfo_.has(e)},e.prototype._getOrCreateFunctionForLabel=function(e,t){var r,s=this.functionInfo_.get(t);return void 0===s?(r=this.functionInfo_.size-1,this._compileFunction(e,r,t)):r=s.idx,r},e.prototype._compileFunction=function(e,t,r){if(!this._isFunctionStart(r)){this.functionInfo_.set(r,{idx:t});for(var n=r==this.mainFunctionAddr_,i=binaryen.i32,o=binaryen.f32,u=binaryen.i64,l=binaryen.Relooper,d=binaryen.none,f={},m=Array.from(this.lableMap_.values()),h=new Map,g=[],b=[],p=W(r),v=p,y=r;y<this.instructions_.length&&(y==r||!this._isFunctionStart(y));y++){var _=this.instructions_[y];if(m.includes(y)||null===p){var w=W(y);null!==p&&p!==w&&b.push({from:p,to:w,condition:d}),p=w}switch(_.op){case"j":b.push({from:p,to:W(_.addr),condition:d}),p=null;break;case"beq":case"bne":case"bge":case"ble":case"bgt":case"blt":case"beqz":case"bnez":case"bgez":case"blez":case"bgtz":case"bltz":b.push({from:p,to:W(y+1),condition:d}),b.push({from:p,to:W(_.addr),condition:c(e,_.op)(O(s.registerName(_.src0)),_.src1?O(s.registerName(_.src1)):e.i32.const(0))}),p=null;break;case"jal":var k=a(this._getOrCreateFunctionForLabel(e,_.addr));p.code.push(e.call(k,[],d));break;case"jr":if(n)throw"cannot have `jr` in main function";p.code.push(e.return());break;case"li":p.code.push(j(s.registerName(_.dst),e.i32.const(_.imm)));break;case"li.s":p.code.push(j(s.registerName(_.dst),e.f32.const(_.imm)));break;case"la":p.code.push(j(s.registerName(_.dst),e.i32.const(_.addr))),_._isInstructionAddress&&this._getOrCreateFunctionForLabel(e,_.addr);break;case"lb":p.code.push(j(s.registerName(_.dst),e.i32.load8_s(_.imm,1,O(s.registerName(_.src)))));break;case"lw":p.code.push(j(s.registerName(_.dst),e.i32.load(_.imm,1,O(s.registerName(_.src)))));break;case"l.s":p.code.push(j(s.registerName(_.dst),e.f32.load(_.imm,1,O(s.registerName(_.src)))));break;case"sb":p.code.push(e.i32.store8(_.imm,1,O(s.registerName(_.src)),O(s.registerName(_.dst))));break;case"sw":p.code.push(e.i32.store(_.imm,1,O(s.registerName(_.src)),O(s.registerName(_.dst))));break;case"s.s":p.code.push(e.f32.store(_.imm,1,O(s.registerName(_.src)),O(s.registerName(_.dst))));break;case"addi":p.code.push(j(s.registerName(_.dst),c(e,_.op)(O(s.registerName(_.src)),e.i32.const(_.imm))));break;case"move":var I=T(s.registerName(_.src1)),x=T(s.registerName(_.src0)),$=void 0;if(I===x)$=O(s.registerName(_.src1));else if(I===i&&x===o)$=e.f32.reinterpret(O(s.registerName(_.src1)));else{if(I!==o||x!==i)throw"unsupported move: "+_;$=e.i32.reinterpret(O(s.registerName(_.src1)))}p.code.push(j(s.registerName(_.src0),$));break;case"cvt.w.s":p.code.push(j(s.registerName(_.src0),e.f32.reinterpret(e.i32.trunc_s.f32(O(s.registerName(_.src1))))));break;case"cvt.s.w":p.code.push(j(s.registerName(_.src0),e.f32.convert_s.i32(e.i32.reinterpret(O(s.registerName(_.src1))))));break;case"add":case"sub":p.code.push(j(s.registerName(_.dst),c(e,_.op)(O(s.registerName(_.src0)),O(s.registerName(_.src1)))));break;case"mult":p.code.push(V("temp",e.i64.mul(e.i64.extend_s(O(s.registerName(_.src0))),e.i64.extend_s(O(s.registerName(_.src1)))),u),j(s.registerName(s.LO),e.i32.wrap(z("temp",u))),j(s.registerName(s.HI),e.i32.wrap(e.i64.shr_s(z("temp",u),e.i64.const(32,0)))));break;case"div":p.code.push(j(s.registerName(s.LO),e.i32.div_s(O(s.registerName(_.src0)),O(s.registerName(_.src1)))),j(s.registerName(s.HI),e.i32.rem_s(O(s.registerName(_.src0)),O(s.registerName(_.src1)))));break;case"add.s":case"sub.s":case"mul.s":case"div.s":p.code.push(j(s.registerName(_.dst),c(e,_.op)(O(s.registerName(_.src0)),O(s.registerName(_.src1)))));break;case"c.eq.s":case"c.ne.s":case"c.gt.s":case"c.lt.s":case"c.ge.s":case"c.le.s":p.code.push(j(s.registerName(s.C1_FLAG),c(e,_.op)(O(s.registerName(_.src0)),O(s.registerName(_.src1)))));break;case"sin":case"cos":p.code.push(j(s.registerName(_.src0),e.call(_.op,[O(s.registerName(_.src1))],o)));break;case"syscall":p.code.push(e.call("syscall",[O(s.registerName(s.V0)),O(s.registerName(s.A0)),O(s.registerName(s.A1)),O(s.registerName(s.A2)),O(s.registerName(s.A3))],d));break;default:throw"op "+_.op+" not implemented"}}for(var A=new l(e),E=0,M=g;E<M.length;E++){var N=M[E];N.ref=A.addBlock(e.block("",N.code))}for(var F=0,R=b;F<R.length;F++){var C=R[F];A.addBranch(C.from.ref,C.to.ref,C.condition,d)}var L=A.renderAndDispose(v.ref,S("loopLabelHelper",i)),B=Object.entries(f).sort((function(e,t){return e[1].idx-t[1].idx})).map((function(e){return e[1].typ}));e.addFunction(a(t),d,d,B,L)}function S(e,t){var r=f[e];if(void 0===r){var s=Object.keys(f).length;return f[e]={idx:s,typ:t},s}if(t!==r.typ)throw"type("+t+") does not match with local var "+r;return r.idx}function z(t,r){return e.getGlobal(t)?e.global.get(t,r):e.local.get(S(t,r),r)}function V(t,r,s){return e.getGlobal(t)?e.global.set(t,r):e.local.set(S(t,s),r)}function T(e){return s.isFloatRegister(e)?o:i}function O(e){return z(e,T(e))}function j(e,t){return V(e,t,T(e))}function W(e){var t=h.get(e);if(void 0!==t)return t;var r={ref:-1,code:[]};return h.set(e,r),g.push(r),r}},e}();t.default=o},146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.increasePointer=t.saveFloat=t.saveByte=t.saveWord=t.loadFloat=t.loadWord=t.loadByte=t.getAddressOfVariable=t.setVariableInDataVariableMap=t.getAsciiString=t.alignMemory=t.setVariableInDataMemoryArr=t.clearMemory=t.MEM_SIZE=t.MEMORY=void 0,t.MEMORY=new WebAssembly.Memory({initial:10,maximum:10}),t.MEM_SIZE=t.MEMORY.buffer.byteLength;var r=new DataView(t.MEMORY.buffer),s=0,n=new Map;t.clearMemory=function(){new Uint8Array(t.MEMORY.buffer).fill(0),s=0,n=new Map},t.setVariableInDataMemoryArr=function(e,t){switch(e){case"word":r.setInt32(s,t,!0),s+=4;break;case"float":r.setFloat32(s,t,!0),s+=4;break;case"byte":r.setInt8(s++,t);break;case"ascii":for(var n=0,a=t;n<a.length;n++){var i=a[n];r.setInt8(s++,i)}}},t.alignMemory=function(e){for(;s%e!=0;)++s},t.getAsciiString=function(e){for(var s=0,n=Math.min(2048,t.MEM_SIZE-e),a=[];s<n;s++){var i=r.getInt8(e+s);if(0==i)break;a.push(String.fromCharCode(i))}return a.join("")},t.setVariableInDataVariableMap=function(e){n.set(e,{start_address:s})},t.getAddressOfVariable=function(e){var t=n.get(e);if(t)return t.start_address},t.loadByte=function(e){if(e>=t.MEM_SIZE)throw"address out of bound";return r.getInt8(e)},t.loadWord=function(e){if(e+3>=t.MEM_SIZE)throw"address out of bound";return r.getInt32(e,!0)},t.loadFloat=function(e){if(e+3>=t.MEM_SIZE)throw"address out of bound";return r.getFloat32(e,!0)},t.saveWord=function(e,s){if(e+3>=t.MEM_SIZE)throw"address out of bound";r.setInt32(e,s,!0)},t.saveByte=function(e,s){if(e>=t.MEM_SIZE)throw"address out of bound";r.setInt8(e,s)},t.saveFloat=function(e,s){if(e+3>=t.MEM_SIZE)throw"address out of bound";r.setFloat32(e,s,!0)},t.increasePointer=function(e){s+=e}},269:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.dbgClear=t.dbgLog=void 0,document.addEventListener("DOMContentLoaded",(function(){r=document.getElementById("debug")})),t.dbgLog=function(e){var t=document.createElement("div");t.textContent=e,r.appendChild(t)},t.dbgClear=function(){r.textContent=""}},677:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{o(s.next(e))}catch(e){a(e)}}function c(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}o((s=s.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,s,n,a,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((n=(n=i.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(84),i=r(868),c=r(453),o=r(131),u=r(269);document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("code_box"),t=null;function r(){document.getElementById("canvas_area").innerHTML="",document.getElementById("terminal_area").innerHTML="",null!=t&&(t.kill(),t=null),u.dbgClear();var r=document.getElementById("optionCompile").checked?c.Runner:i.Runner;try{o.createTerminal(800,550),u.dbgLog("parsing...");var s=a.parse(e.value);(t=new r(s.instructions,s.labelMap,s.instrarr_start_index)).run()}catch(e){u.dbgLog(e.toString())}}function l(){return s(this,void 0,void 0,(function(){var t,s;return n(this,(function(n){switch(n.label){case 0:return u.dbgLog("loading the donut demo..."),[4,fetch("./donut.asm")];case 1:return t=n.sent(),s=e,[4,t.text()];case 2:return s.value=n.sent(),r(),[2]}}))}))}o.createTerminal(800,550),document.getElementById("run_btn").addEventListener("click",r),document.getElementById("demo_snake").addEventListener("click",(function(){return s(void 0,void 0,void 0,(function(){var t,s;return n(this,(function(n){switch(n.label){case 0:return u.dbgLog("loading the snake demo..."),[4,fetch("./snake.asm")];case 1:return t=n.sent(),s=e,[4,t.text()];case 2:return s.value=n.sent(),r(),[2]}}))}))})),document.getElementById("demo_donut").addEventListener("click",l),window.addEventListener("load",l)}))},84:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t._isItype=t._isRtype=t.IsIType=t.IsRType=t.REGEXS=void 0;var s=r(146),n=r(532),a=/^\s*(?:([\w\.]+)\s+(.+?))?\s*(?:#.*)?$/,i=/^\s*(?:(\w+):)?(?:\s*\.(\w+)\s+((\".+?\")|(.+?)))?\s*(?:#.*)?$/,c=/\s*,\s*|\s+/,o=/^\s*(\$\w+)\s+(\d+)\((\$\w+)\)\s*$/,u=/^\s*(\$\w+)\s+((?:\-)?\d+)\s*$/,l=/^\s*(\$\w+)\s+((?:\-)?\d*\.\d*)\s*$/,d=/^\s*(\$\w+)\s+(\w+)\s*$/,f=/^\s*(\$(ra|31))\s*$/,m=/^\s*(\w+)\s*$/,h=/^\s*(\$\w+)\s+(?:(\$\w+)\s+)?(\w+)\s*$/,g=/^\s*(\$\w+)\s*$/,b=/^\s*(\$\w+)\s+(\$\w+)\s*$/,p=/^\s*(\$\w+)\s+(\$\w+)\s+(\$\w+)\s*$/,v=/^\s*(\$\w+)\s+(\$\w+)\s+((?:\-)?\d+)\s*$/,y=/^\s*(\w+)\:\s*(?:#.*)?$/,_=/^\s*(syscall)\s*(?:#.*)?$/,w=/^\s*(#).*\s*$/;function k(e){if(!(e=e.trim()))return[];if('"'!=e[0]||'"'!=e[e.length-1])throw'bad ascii string "'+e+'"';var t=e.slice(1,e.length-1).split("").map((function(e){return e.charCodeAt(0)}));if(t.some((function(e){return e>255})))throw'bad string "'+e+'" containing non-ascii character(s)';return t}function I(e){switch(e){case"add":case"add.s":case"sub":case"sub.s":case"mul.s":case"div.s":return!0;default:return!1}}function x(e){switch(e){case"sb":case"sw":case"s.s":case"lb":case"lw":case"l.s":case"addi":return!0;default:return!1}}t.REGEXS={INSTRUCTION_TYPE:a,VAR_DEF:i,SPLIT_SEPARATORS:c},t.IsRType=function(e){return void 0!==e.src1},t.IsIType=function(e){return void 0!==e.imm},t._isRtype=I,t._isItype=x,RegExp.prototype.mustExec=function(e){var t=this.exec(e);if(!t||!t.length)throw"fail to match '"+e+"' with '"+this.source+"'";return t},t.parse=function(e){var t,r=[],$=new Map,A=0;s.clearMemory();for(var E=e.split("\n"),M=0;M<E.length;M++){var N=E[M].trim();if(N&&!w.exec(N))switch(N){case".data":if(2==A)throw".data must appear before .text";A=1;break;case".text":A=2;break;case".main":t=r.length;break;default:if(1==A){if(!(C=i.exec(N))||!C.length)throw"bad instruction: "+N;C[1]&&s.setVariableInDataVariableMap(C[1]);var F=C[2];switch(F){case"word":C[3].trim().split(c).forEach((function(e){s.setVariableInDataMemoryArr("word",parseInt(e.trim()))}));break;case"float":C[3].trim().split(c).forEach((function(e){s.setVariableInDataMemoryArr("float",parseFloat(e.trim()))}));break;case"byte":C[3].trim().split(c).forEach((function(e){s.setVariableInDataMemoryArr("byte",parseInt(e.trim()))}));break;case"ascii":case"asciiz":var R=k(C[3]);"asciiz"===F&&R.push(0),s.setVariableInDataMemoryArr("ascii",R);break;case"align":s.alignMemory(parseInt(C[3].trim()));break;case"space":s.increasePointer(parseInt(C[3].trim()));break;default:if(null!=C[2]||null!=C[3])throw"not a valid type"}}else if(2==A){var C=null;if((C=_.exec(N))&&C.length){r.push({op:"syscall"});break}if((C=y.exec(N))&&C.length){$.set(C[1],r.length);break}var L=(C=a.mustExec(N))[1];switch(L){case"la":C=d.mustExec(C[2]);var B={op:"la",dst:n.getRegisterIndexByName(C[1]),addr:-1,_isInstructionAddress:!1,_name:C[2]};r.push(B);break;case"lb":case"lw":case"l.s":case"sb":case"sw":case"s.s":C=o.mustExec(C[2]);var S={op:L,dst:n.getRegisterIndexByName(C[1]),imm:parseInt(C[2]),src:n.getRegisterIndexByName(C[3])};r.push(S);break;case"sin":case"cos":case"div":case"mult":case"move":case"cvt.w.s":case"cvt.s.w":case"c.lt.s":case"c.le.s":case"c.gt.s":case"c.ge.s":case"c.eq.s":case"c.ne.s":C=b.mustExec(C[2]);var z={op:L,src0:n.getRegisterIndexByName(C[1]),src1:n.getRegisterIndexByName(C[2])};r.push(z);break;case"mfhi":case"mflo":C=g.mustExec(C[2]);var V={op:"move",src0:n.getRegisterIndexByName(C[1]),src1:n.getRegisterIndexByName("mfhi"===L?"$HI":"$LO")};r.push(V);break;case"mfc1":C=b.mustExec(C[2]),r.push({op:"move",src0:n.getRegisterIndexByName(C[1]),src1:n.getRegisterIndexByName(C[2])});break;case"mtc1":C=b.mustExec(C[2]),r.push({op:"move",src0:n.getRegisterIndexByName(C[2]),src1:n.getRegisterIndexByName(C[1])});break;case"bc1t":case"bc1f":C=m.mustExec(C[2]);var T={op:"bc1f"===L?"beqz":"bnez",src0:n.C1_FLAG,addr:-1,_name:C[1]};r.push(T);break;case"j":case"jal":var O={op:L,addr:-1,_name:(C=m.mustExec(C[2]))[1]};r.push(O);break;case"jr":f.mustExec(C[2]),r.push({op:"jr"});break;case"li.s":C=l.mustExec(C[2]);var j={op:"li.s",dst:n.getRegisterIndexByName(C[1]),imm:parseFloat(C[2])};r.push(j);break;case"li":C=u.mustExec(C[2]);var W={op:"li",dst:n.getRegisterIndexByName(C[1]),imm:parseInt(C[2])};r.push(W);break;case"beq":case"bne":case"bge":case"ble":case"bgt":case"blt":C=h.mustExec(C[2]);var D={op:L,src0:n.getRegisterIndexByName(C[1]),src1:n.getRegisterIndexByName(C[2]),addr:-1,_name:C[3]};r.push(D);break;case"beqz":case"bnez":case"bgez":case"blez":case"bgtz":case"bltz":if(C=h.mustExec(C[2]),D={op:L,src0:n.getRegisterIndexByName(C[1]),addr:-1,_name:C[3]},C[2])throw L+" should only have one register arg: "+N;r.push(D);break;default:if(I(L)){C=p.mustExec(C[2]);var P={op:L,dst:n.getRegisterIndexByName(C[1]),src0:n.getRegisterIndexByName(C[2]),src1:n.getRegisterIndexByName(C[3])};r.push(P)}else{if(!x(L))throw"unsupported instruction: "+N;C=v.mustExec(C[2]);var q={op:L,dst:n.getRegisterIndexByName(C[1]),src:n.getRegisterIndexByName(C[2]),imm:parseInt(C[3])};r.push(q)}}}}}return function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(a.hasOwnProperty("_name")){if(!a._name)throw"undefined name: "+a;var i=t.get(a._name);if(void 0===i){if("la"===a.op){var c=s.getAddressOfVariable(a._name);if(void 0!==c){a.addr=c;continue}}throw"undefined name: "+a._name}a.addr=i,"la"===a.op&&(a._isInstructionAddress=!0)}}}(r,$),{instructions:r,labelMap:$,instrarr_start_index:t}}},532:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRawBytes=t.set=t.setFloat=t.getFloat=t.cvtws=t.cvtsw=t.move=t.get=t.getRegisterIndexByName=t.isFloatRegister=t.registerName=t.C1_FLAG=t.LO=t.HI=t.SP=t.A3=t.A2=t.A1=t.A0=t.V1=t.V0=t.RA=void 0;var s=r(146).MEM_SIZE,n=["$zero","$at","$v0","$v1","$a0","$a1","$a2","$a3","$t0","$t1","$t2","$t3","$t4","$t5","$t6","$t7","$s0","$s1","$s2","$s3","$s4","$s5","$s6","$s7","$t8","$t9","$k0","$k1","$gp","$sp","$fp","$ra","$f0","$f1","$f2","$f3","$f4","$f5","$f6","$f7","$f8","$f9","$f10","$f11","$f12","$f13","$f14","$f15","$f16","$f17","$f18","$f19","$f20","$f21","$f22","$f23","$f24","$f25","$f26","$f27","$f28","$f29","$f30","$f31","$HI","$LO","$C1_FLAG"],a=!0,i=new Array(n.length),c={};function o(e,t){i[e].setInt32(0,t,a)}!function(){for(var e=0;e<n.length;e++)c[n[e]]=e,i[e]=new DataView(new ArrayBuffer(4)),i[e].setUint32(0,0,a);i[c.$sp].setInt32(0,s,a)}(),t.RA=31,t.V0=2,t.V1=3,t.A0=4,t.A1=5,t.A2=6,t.A3=7,t.SP=c.$sp,t.HI=c.$HI,t.LO=c.$LO,t.C1_FLAG=c.$C1_FLAG,t.registerName=function(e){return n[e]},t.isFloatRegister=function(e){var t=c[e];return void 0!==t&&t>=32&&t<=63},t.getRegisterIndexByName=function(e){var t=c[e];if(void 0===t)throw"unknown register name "+e;return t},t.get=function(e){return i[e].getInt32(0,a)},t.move=function(e,t){i[e].setInt32(0,i[t].getInt32(0,a),a)},t.cvtsw=function(e,t){i[t].setFloat32(0,i[e].getInt32(0,a),a)},t.cvtws=function(e,t){var r=i[t].getFloat32(0,a);o(e,r=r<0?-1*Math.floor(-r):Math.floor(r))},t.getFloat=function(e){return i[e].getFloat32(0,a)},t.setFloat=function(e,t){i[e].setFloat32(0,t,a)},t.set=o,t.getRawBytes=function(e){return i[e].buffer}},868:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;var s=r(84),n=r(146),a=r(532),i=r(488),c=r(269),o=r(131).flush;function u(e,t){return e+t}function l(e,t){return e-t}function d(e,t){return e==t}function f(e,t){return e!=t}function m(e,t){return e>=t}function h(e,t){return e<=t}function g(e,t){return e>t}function b(e,t){return e<t}var p={add:u,addi:u,sub:l,"add.s":u,"sub.s":l,"mul.s":function(e,t){return e*t},"div.s":function(e,t){return e/t},lw:function(e,t){return n.loadWord(e+t)},lb:function(e,t){return n.loadByte(e+t)},beq:d,bne:f,bge:m,ble:h,bgt:g,blt:b,beqz:d,bnez:f,bgez:m,blez:h,bgtz:g,bltz:b,"c.lt.s":b,"c.le.s":h,"c.gt.s":g,"c.ge.s":m,"c.eq.s":d,"c.ne.s":f},v=function(){function e(e,t,r){this.instructions_=e,this.instrarr_start_index_=r,this.isRunning_=!1,this.isRunning_=!0,console.log(this.instructions_)}return e.prototype.isRunning=function(){return this.isRunning_},e.prototype.runFrom=function(e){var t,r=e,u=!1;for(c.dbgLog("running..."),Date.now();r<this.instructions_.length&&!u&&this.isRunning_;){t=r+1;var l=this.instructions_[r];switch(l.op){case"l.s":var d=a.get(l.src)+l.imm;a.setFloat(l.dst,n.loadFloat(d));break;case"s.s":d=a.get(l.src)+l.imm,n.saveFloat(d,a.getFloat(l.dst));break;case"li.s":a.setFloat(l.dst,l.imm);break;case"cvt.s.w":a.cvtsw(l.src1,l.src0);break;case"cvt.w.s":a.cvtws(l.src0,l.src1);break;case"c.lt.s":case"c.le.s":case"c.gt.s":case"c.ge.s":case"c.eq.s":case"c.ne.s":a.set(a.C1_FLAG,Number(p[l.op](a.getFloat(l.src0),a.getFloat(l.src1))));break;case"la":a.set(l.dst,l.addr);break;case"sb":d=a.get(l.src)+l.imm,n.saveByte(d,a.get(l.dst));break;case"sw":d=a.get(l.src)+l.imm,n.saveWord(d,a.get(l.dst));break;case"mult":var f=a.get(l.src0)*a.get(l.src1);a.set(a.LO,f);break;case"div":var m=a.get(l.src0),h=a.get(l.src1);a.set(a.LO,Math.floor(m/h)),a.set(a.HI,m%h);break;case"move":a.move(l.src0,l.src1);break;case"jr":var g=a.get(a.RA);if(99999==g){u=!0;break}t=g;break;case"j":t=l.addr;break;case"jal":a.set(a.RA,r+1),t=l.addr;break;case"li":a.set(l.dst,l.imm);break;case"beq":case"bne":case"bge":case"ble":case"bgt":case"blt":p[l.op](a.get(l.src0),a.get(l.src1))&&(t=l.addr);break;case"beqz":case"bnez":case"bgez":case"blez":case"bgtz":case"bltz":p[l.op](a.get(l.src0),0)&&(t=l.addr);break;case"sin":a.setFloat(l.src0,Math.sin(a.getFloat(l.src1)));break;case"cos":a.setFloat(l.src0,Math.cos(a.getFloat(l.src1)));break;case"syscall":var b=a.get(a.V0);if(999==b){u=!0;break}if(10==b){this.isRunning_=!1,u=!0;break}if(i.syscall(b,this,t)){u=!0;break}break;default:if(s.IsRType(l)){var v=p[l.op];if(l.op.endsWith(".s")){var y=a.getFloat(l.src0),_=a.getFloat(l.src1);a.setFloat(l.dst,v(y,_))}else y=a.get(l.src0),_=a.get(l.src1),a.set(l.dst,v(y,_))}else{if(!s.IsIType(l))throw"cannot execute instruction: "+l;var w=(v=p[l.op])(a.get(l.src),l.imm);a.set(l.dst,w)}}r=t}!u&&r>=this.instructions_.length&&(this.isRunning_=!1),o()},e.prototype.run=function(){this.runFrom(this.instrarr_start_index_)},e.prototype.kill=function(){this.isRunning_=!1},e.prototype.syscallCallbackFunction=function(e,t,r){a.set(a.RA,99999),null!=t&&a.set(a.V0,t),null!=r&&a.set(a.V1,r),this.runFrom(e)},e}();t.Runner=v},488:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syscall=t.rand=void 0;var s=r(532),n=r(131),a=r(28),i=r(146);function c(e,t,r){return Math.floor(Math.random()*(t-e)/r)*r+e}t.rand=c,Date.now(),t.syscall=function(e,t,r){switch(e){case 1:n.print(s.get(s.A0).toString());break;case 2:n.print(s.getFloat(s.A0).toString());break;case 3:break;case 4:n.print(i.getAsciiString(s.get(s.A0)));break;case 11:n.putchar(s.get(s.A0));break;case 12:return n.getChar((function(e){s.set(s.V0,e),t.runFrom(r)})),!0;case 5:return n.getInt((function(e){s.set(s.V0,e),t.runFrom(r)})),!0;case 6:throw"read float not implemented";case 7:throw"read double not implemented";case 45:s.set(s.V0,c(s.get(s.A0),s.get(s.A1),s.get(s.A2)));break;case 100:a.create(s.get(s.A0),s.get(s.A1));break;case 101:a.fillRect(s.get(s.A0),s.get(s.A1),s.get(s.A2),s.get(s.A3));break;case 102:a.clearRect(s.get(s.A0),s.get(s.A1),s.get(s.A2),s.get(s.A3));break;case 103:a.setFillStyle(s.get(s.A0),s.get(s.A1),s.get(s.A2));break;case 300:var o=i.getAsciiString(s.get(s.A0)),u=s.get(s.A1);a.addEventListener(o,[s.get(s.A2),s.get(s.A3)],(function(e,r){t.syscallCallbackFunction(u,e,r)}));break;case 400:n.createTerminal(s.get(s.A0),s.get(s.A1));break;case 401:n.clear();break;case 600:break;default:throw"xxx"}}},131:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getChar=t.getInt=t.putchar=t.print=t.flush=t.clear=t.createTerminal=void 0;var s,n=r(518);t.createTerminal=function(e,t){(s=new n.Terminal).setWidth(e),s.setHeight(t),document.getElementById("terminal_area").appendChild(s.html)},t.clear=function(){s.clear()};var a="",i=0,c=new Uint8Array(2048),o=new TextDecoder("utf-8");function u(){a?(s.print(a),a=""):i>0&&(s.print(o.decode(c.subarray(0,i))),i=0)}t.flush=u,t.print=function(e){i>0&&(a+=o.decode(c.subarray(0,i)),i=0),(a+=e).length>2048&&u()},t.putchar=function(e){(a||i>=c.length)&&u(),c[i++]=e};var l="";function d(e,t){setTimeout(e,1,t)}t.getInt=function(e){u(),l.length>0?(e(parseInt(l)),l=""):s.input("",(function(t){e(parseInt(t))}))},t.getChar=function(e){u(),l.length>0?(d(e,l.charCodeAt(0)),l=l.substring(1)):s.input("",(function(t){l+=t.substring(1),d(e,l.charCodeAt(0))}))}},453:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;var s=r(597),n=r(146),a=r(269),i=r(131),c=r(28),o=r(488),u=function(){function e(e,t,r){this.instructions_=e,this.labelMap_=t,this.instrarr_start_index_=r,this.wasm_functions_=null,this.instance_=null;var n=new s.default(e,t,r);a.dbgLog("optimizing...");var i=n.compile();this.wasm_=i.wasm,this.wasm_functions_=i.functions}return e.prototype.kill=function(){try{this.instance_&&this.instance_.exports.exit()}catch(e){if(!(e instanceof WebAssembly.RuntimeError&&"unreachable"===e.message))throw e}},e.prototype._saveInstance=function(e){this.instance_=e},e.prototype.run=function(){if(this.instance_)throw"there is already a WASM instance running";var e=this;a.dbgLog("compiling...");var t=new WebAssembly.Module(this.wasm_),r=new WebAssembly.Instance(t,{math:{sin:Math.sin,cos:Math.cos},env:{syscall:function(t,s,u,l,d){try{switch(t){case 1:i.print(String(s));break;case 2:var f=new DataView(new ArrayBuffer(4));f.setInt32(0,s,!0),i.print(String(f.getFloat32(0,!0)));break;case 4:i.print(n.getAsciiString(s));break;case 10:r.exports.exit();break;case 11:i.putchar(s);break;case 45:r.exports.setV0V1(o.rand(s,u,l),0);break;case 999:e._saveInstance(r);break;case 300:var m=n.getAsciiString(s),h=e.wasm_functions_?e.wasm_functions_.get(u):void 0;if(void 0===h)throw"function index not found for label address: "+u;c.addEventListener(m,[l,d],(function(t,r){Date.now();var s=e.instance_;if(!s)throw"in event callback, no instance running";var n=s.exports.callback;if(!n)throw"callback not exported";t=t||0,r=r||0,n(h.idx,t,r),i.flush()}));break;case 100:c.create(s,u);break;case 101:c.fillRect(s,u,l,d);break;case 102:c.clearRect(s,u,l,d);break;case 103:c.setFillStyle(s,u,l);break;case 400:i.createTerminal(s,u);break;case 401:i.clear();break;default:throw"syscall "+t+" not implemented"}}catch(e){a.dbgLog(e.toString()),r.exports.exit()}},memory:n.MEMORY}});a.dbgLog("running..."),Date.now();try{r.exports.main()}catch(e){if(!(e instanceof WebAssembly.RuntimeError&&"unreachable"===e.message))throw e}i.flush()},e}();t.Runner=u}},t={};!function r(s){if(t[s])return t[s].exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}(677)})();